<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CausalGPS">
<title>Synthetic Medicare Data • CausalGPS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Synthetic Medicare Data">
<meta property="og:description" content="CausalGPS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CausalGPS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.8.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/CausalGPS.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/Estimating-GPS.html">Estimating GPS</a>
    <a class="dropdown-item" href="../articles/Generating-Pseudo-Population.html">Generating Pseudo Population</a>
    <a class="dropdown-item" href="../articles/Outcome-Models.html">Outcome Models</a>
    <a class="dropdown-item" href="../articles/Generating-Synthetic-Data.html">Generate Synthetic Data</a>
    <a class="dropdown-item" href="../articles/Synthetic-Medicare.html">Synthetic Medicare Data</a>
    <a class="dropdown-item" href="../articles/Frequently-Asked-Questions.html">Frequently Asked Questions</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Collabration</h6>
    <a class="dropdown-item" href="../articles/Developers-Guide.html">Developers Guide</a>
    <a class="dropdown-item" href="../articles/Testing-the-Package.html">Testing the Package</a>
    <a class="dropdown-item" href="../articles/Notes-on-SL-Wrapper.html">Notes on SL Wrappers</a>
    <a class="dropdown-item" href="../articles/Singularity-Image.html">Singularity</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NSAPH-Software/CausalGPS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Synthetic Medicare Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NSAPH-Software/CausalGPS/blob/HEAD/vignettes/Synthetic-Medicare.Rmd" class="external-link"><code>vignettes/Synthetic-Medicare.Rmd</code></a></small>
      <div class="d-none name"><code>Synthetic-Medicare.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NSAPH-Software/CausalGPS" class="external-link">CausalGPS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette, we present application of CausalGPS package on the
Synthetic Medicare Data. In the dataset, we link the 2010 synthetic
Medicare claims data to environmental exposures and potential
confounders. The dataset is hosted on Harvard Dataverse <span class="citation">(Khoshnevis, Wu, and Braun 2022)</span>.</p>
<div class="section level2">
<h2 id="load-data-and-preprocessing">Load Data and Preprocessing<a class="anchor" aria-label="anchor" href="#load-data-and-preprocessing"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"synthetic_us_2010"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">synthetic_us_2010</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="0%">
<col width="1%">
<col width="3%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="2%">
<col width="1%">
<col width="1%">
<col width="3%">
<col width="1%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="1%">
<col width="2%">
<col width="2%">
<col width="1%">
<col width="2%">
<col width="2%">
<col width="1%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="1%">
<col width="1%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="0%">
<col width="1%">
<col width="0%">
</colgroup>
<thead><tr class="header">
<th align="right">FIPS</th>
<th align="right">qd_mean_pm25</th>
<th align="left">NAME</th>
<th align="right">cs_poverty</th>
<th align="right">cs_hispanic</th>
<th align="right">cs_black</th>
<th align="right">cs_white</th>
<th align="right">cs_native</th>
<th align="right">cs_asian</th>
<th align="right">cs_ed_below_highschool</th>
<th align="right">cs_household_income</th>
<th align="right">cs_median_house_value</th>
<th align="right">cs_total_population</th>
<th align="right">cs_other</th>
<th align="right">cs_area</th>
<th align="right">cs_population_density</th>
<th align="right">cdc_mean_bmi</th>
<th align="right">cdc_pct_cusmoker</th>
<th align="right">cdc_pct_sdsmoker</th>
<th align="right">cdc_pct_fmsmoker</th>
<th align="right">cdc_pct_nvsmoker</th>
<th align="right">cdc_pct_nnsmoker</th>
<th align="right">gmet_mean_tmmn</th>
<th align="right">gmet_mean_summer_tmmn</th>
<th align="right">gmet_mean_winter_tmmn</th>
<th align="right">gmet_mean_tmmx</th>
<th align="right">gmet_mean_summer_tmmx</th>
<th align="right">gmet_mean_winter_tmmx</th>
<th align="right">gmet_mean_rmn</th>
<th align="right">gmet_mean_summer_rmn</th>
<th align="right">gmet_mean_winter_rmn</th>
<th align="right">gmet_mean_rmx</th>
<th align="right">gmet_mean_summer_rmx</th>
<th align="right">gmet_mean_winter_rmx</th>
<th align="right">gmet_mean_sph</th>
<th align="right">gmet_mean_summer_sph</th>
<th align="right">gmet_mean_winter_sph</th>
<th align="right">cms_mortality_pct</th>
<th align="right">cms_white_pct</th>
<th align="right">cms_black_pct</th>
<th align="right">cms_others_pct</th>
<th align="right">cms_hispanic_pct</th>
<th align="right">cms_female_pct</th>
<th align="right">STATE</th>
<th align="left">STATE_CODE</th>
<th align="left">region</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1001</td>
<td align="right">11.85557</td>
<td align="left">Autauga County, Alabama</td>
<td align="right">0.0858086</td>
<td align="right">0.0028053</td>
<td align="right">0.1320132</td>
<td align="right">0.8524752</td>
<td align="right">0.0087459</td>
<td align="right">0.0026403</td>
<td align="right">0.2533003</td>
<td align="right">37351</td>
<td align="right">133900</td>
<td align="right">53155</td>
<td align="right">0.0013201</td>
<td align="right">594.436</td>
<td align="right">89.42090</td>
<td align="right">3208.390</td>
<td align="right">0.1463415</td>
<td align="right">0.0243902</td>
<td align="right">0.2439024</td>
<td align="right">0.5609756</td>
<td align="right">0.0243902</td>
<td align="right">283.8634</td>
<td align="right">295.4464</td>
<td align="right">273.0409</td>
<td align="right">297.2615</td>
<td align="right">307.2943</td>
<td align="right">284.5251</td>
<td align="right">40.42980</td>
<td align="right">45.25372</td>
<td align="right">43.95282</td>
<td align="right">88.97211</td>
<td align="right">95.95946</td>
<td align="right">85.72278</td>
<td align="right">0.0094171</td>
<td align="right">0.0167348</td>
<td align="right">0.0040017</td>
<td align="right">0.0000000</td>
<td align="right">0.5958904</td>
<td align="right">0.4041096</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.5547945</td>
<td align="right">1</td>
<td align="left">AL</td>
<td align="left">SOUTH</td>
</tr>
<tr class="even">
<td align="right">1003</td>
<td align="right">10.43793</td>
<td align="left">Baldwin County, Alabama</td>
<td align="right">0.0533287</td>
<td align="right">0.0140393</td>
<td align="right">0.0515350</td>
<td align="right">0.9186271</td>
<td align="right">0.0054157</td>
<td align="right">0.0022422</td>
<td align="right">0.1609521</td>
<td align="right">40104</td>
<td align="right">177200</td>
<td align="right">175791</td>
<td align="right">0.0081407</td>
<td align="right">1589.784</td>
<td align="right">110.57540</td>
<td align="right">3249.755</td>
<td align="right">0.1470588</td>
<td align="right">0.0392157</td>
<td align="right">0.2450980</td>
<td align="right">0.5686275</td>
<td align="right">0.0000000</td>
<td align="right">285.8735</td>
<td align="right">296.6723</td>
<td align="right">275.4020</td>
<td align="right">298.1579</td>
<td align="right">306.4516</td>
<td align="right">287.3572</td>
<td align="right">42.34226</td>
<td align="right">50.02479</td>
<td align="right">43.42646</td>
<td align="right">90.28333</td>
<td align="right">95.14939</td>
<td align="right">88.16227</td>
<td align="right">0.0102607</td>
<td align="right">0.0172820</td>
<td align="right">0.0047839</td>
<td align="right">0.0227273</td>
<td align="right">0.6384298</td>
<td align="right">0.3533058</td>
<td align="right">0.0082645</td>
<td align="right">0.0000000</td>
<td align="right">0.5392562</td>
<td align="right">1</td>
<td align="left">AL</td>
<td align="left">SOUTH</td>
</tr>
<tr class="odd">
<td align="right">1005</td>
<td align="right">11.50424</td>
<td align="left">Barbour County, Alabama</td>
<td align="right">0.1944298</td>
<td align="right">0.0094587</td>
<td align="right">0.3334209</td>
<td align="right">0.6560694</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4051498</td>
<td align="right">22143</td>
<td align="right">88200</td>
<td align="right">27699</td>
<td align="right">0.0010510</td>
<td align="right">884.876</td>
<td align="right">31.30269</td>
<td align="right">2953.693</td>
<td align="right">0.0714047</td>
<td align="right">0.0504250</td>
<td align="right">0.2168344</td>
<td align="right">0.5645023</td>
<td align="right">0.0111988</td>
<td align="right">284.1352</td>
<td align="right">295.3782</td>
<td align="right">273.8296</td>
<td align="right">297.6494</td>
<td align="right">307.0302</td>
<td align="right">285.5848</td>
<td align="right">40.05212</td>
<td align="right">46.02080</td>
<td align="right">43.77853</td>
<td align="right">90.76408</td>
<td align="right">96.72028</td>
<td align="right">86.72719</td>
<td align="right">0.0097046</td>
<td align="right">0.0169258</td>
<td align="right">0.0043431</td>
<td align="right">0.0000000</td>
<td align="right">0.6901408</td>
<td align="right">0.2816901</td>
<td align="right">0.0281690</td>
<td align="right">0.0000000</td>
<td align="right">0.5070423</td>
<td align="right">1</td>
<td align="left">AL</td>
<td align="left">SOUTH</td>
</tr>
<tr class="even">
<td align="right">1007</td>
<td align="right">11.88692</td>
<td align="left">Bibb County, Alabama</td>
<td align="right">0.1130868</td>
<td align="right">0.0010669</td>
<td align="right">0.1219772</td>
<td align="right">0.8662873</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.3886913</td>
<td align="right">24875</td>
<td align="right">81200</td>
<td align="right">22610</td>
<td align="right">0.0106686</td>
<td align="right">622.582</td>
<td align="right">36.31650</td>
<td align="right">3255.287</td>
<td align="right">0.1034483</td>
<td align="right">0.0229885</td>
<td align="right">0.3103448</td>
<td align="right">0.5517241</td>
<td align="right">0.0114943</td>
<td align="right">283.5388</td>
<td align="right">295.3145</td>
<td align="right">272.5781</td>
<td align="right">296.7969</td>
<td align="right">307.0417</td>
<td align="right">283.9070</td>
<td align="right">41.59857</td>
<td align="right">47.24975</td>
<td align="right">43.87743</td>
<td align="right">89.57623</td>
<td align="right">96.48472</td>
<td align="right">85.84614</td>
<td align="right">0.0093942</td>
<td align="right">0.0169568</td>
<td align="right">0.0038307</td>
<td align="right">0.0215264</td>
<td align="right">0.6555773</td>
<td align="right">0.3405088</td>
<td align="right">0.0039139</td>
<td align="right">0.0000000</td>
<td align="right">0.5714286</td>
<td align="right">1</td>
<td align="left">AL</td>
<td align="left">SOUTH</td>
</tr>
<tr class="odd">
<td align="right">1009</td>
<td align="right">11.65920</td>
<td align="left">Blount County, Alabama</td>
<td align="right">0.1047926</td>
<td align="right">0.0094363</td>
<td align="right">0.0105538</td>
<td align="right">0.9684629</td>
<td align="right">0.0058356</td>
<td align="right">0.0000000</td>
<td align="right">0.3594487</td>
<td align="right">25857</td>
<td align="right">113700</td>
<td align="right">56692</td>
<td align="right">0.0057114</td>
<td align="right">644.776</td>
<td align="right">87.92511</td>
<td align="right">3500.333</td>
<td align="right">0.0833333</td>
<td align="right">0.0000000</td>
<td align="right">0.2500000</td>
<td align="right">0.6388889</td>
<td align="right">0.0277778</td>
<td align="right">282.6099</td>
<td align="right">294.7041</td>
<td align="right">271.3427</td>
<td align="right">295.5558</td>
<td align="right">306.4517</td>
<td align="right">281.9145</td>
<td align="right">42.44578</td>
<td align="right">48.28317</td>
<td align="right">46.07121</td>
<td align="right">88.72523</td>
<td align="right">96.37532</td>
<td align="right">84.95932</td>
<td align="right">0.0089541</td>
<td align="right">0.0165894</td>
<td align="right">0.0035027</td>
<td align="right">0.0062112</td>
<td align="right">0.7018634</td>
<td align="right">0.2981366</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.6086957</td>
<td align="right">1</td>
<td align="left">AL</td>
<td align="left">SOUTH</td>
</tr>
<tr class="even">
<td align="right">1011</td>
<td align="right">11.65386</td>
<td align="left">Bullock County, Alabama</td>
<td align="right">0.1701807</td>
<td align="right">0.0000000</td>
<td align="right">0.5903614</td>
<td align="right">0.4096386</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4487952</td>
<td align="right">20500</td>
<td align="right">66300</td>
<td align="right">10923</td>
<td align="right">0.0000000</td>
<td align="right">622.805</td>
<td align="right">17.53839</td>
<td align="right">3400.474</td>
<td align="right">0.1282051</td>
<td align="right">0.0384615</td>
<td align="right">0.3333333</td>
<td align="right">0.5000000</td>
<td align="right">0.0000000</td>
<td align="right">283.3906</td>
<td align="right">295.0217</td>
<td align="right">273.1478</td>
<td align="right">297.2145</td>
<td align="right">306.8042</td>
<td align="right">285.0072</td>
<td align="right">41.29272</td>
<td align="right">46.77274</td>
<td align="right">44.80368</td>
<td align="right">92.81798</td>
<td align="right">97.60276</td>
<td align="right">88.14277</td>
<td align="right">0.0096621</td>
<td align="right">0.0169198</td>
<td align="right">0.0042435</td>
<td align="right">0.0103245</td>
<td align="right">0.6666667</td>
<td align="right">0.3185841</td>
<td align="right">0.0132743</td>
<td align="right">0.0014749</td>
<td align="right">0.5501475</td>
<td align="right">1</td>
<td align="left">AL</td>
<td align="left">SOUTH</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># transformers</span></span>
<span><span class="va">pow2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">}</span></span>
<span><span class="va">pow3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">^</span><span class="fl">3</span><span class="op">}</span></span>
<span><span class="va">clog</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">0.001</span><span class="op">)</span></span>
<span></span>
<span><span class="va">confounders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">confounders</span> <span class="op">&lt;-</span> <span class="va">confounders</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">confounders</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FIPS"</span>,<span class="st">"Name"</span>,<span class="st">"STATE"</span>, </span>
<span>                                                <span class="st">"STATE_CODE"</span>,<span class="st">"cms_mortality_pct"</span>,</span>
<span>                                                <span class="st">"qd_mean_pm25"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples-of-generating-pseudo-population">Examples of Generating Pseudo Population<a class="anchor" aria-label="anchor" href="#examples-of-generating-pseudo-population"></a>
</h2>
<div class="section level3">
<h3 id="scenario-1">Scenario 1<a class="anchor" aria-label="anchor" href="#scenario-1"></a>
</h3>
<ul>
<li>Causal Inference: Matching</li>
<li>GPS model: Parametric</li>
<li>Optimized_compile: True</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">confounders_s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cs_poverty"</span>,<span class="st">"cs_hispanic"</span>,</span>
<span>                   <span class="st">"cs_black"</span>,</span>
<span>                   <span class="st">"cs_ed_below_highschool"</span>,</span>
<span>                   <span class="st">"cs_median_house_value"</span>,</span>
<span>                   <span class="st">"cs_population_density"</span>,</span>
<span>                   <span class="st">"cdc_mean_bmi"</span>,<span class="st">"cdc_pct_nvsmoker"</span>,</span>
<span>                   <span class="st">"gmet_mean_summer_tmmx"</span>,</span>
<span>                   <span class="st">"gmet_mean_summer_rmx"</span>,</span>
<span>                   <span class="st">"gmet_mean_summer_sph"</span>,</span>
<span>                   <span class="st">"cms_female_pct"</span>, <span class="st">"region"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">study_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qd_mean_pm25"</span>, <span class="va">confounders</span>, <span class="st">"cms_mortality_pct"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">study_data</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="va">study_data</span><span class="op">$</span><span class="va">cs_PIR</span> <span class="op">&lt;-</span> <span class="va">study_data</span><span class="op">$</span><span class="va">cs_median_house_value</span><span class="op">/</span><span class="va">study_data</span><span class="op">$</span><span class="va">cs_household_income</span></span>
<span></span>
<span><span class="co"># Choose subset of data</span></span>
<span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">$</span><span class="va">qd_mean_pm25</span>,<span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">$</span><span class="va">qd_mean_pm25</span>,<span class="fl">0.99</span><span class="op">)</span></span>
<span><span class="va">trimmed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">[</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">)</span> ,<span class="op">]</span>,</span>
<span>                       <span class="va">qd_mean_pm25</span> <span class="op">&lt;=</span> <span class="va">q2</span>  <span class="op">&amp;</span> <span class="va">qd_mean_pm25</span> <span class="op">&gt;=</span> <span class="va">q1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">gmet_mean_summer_sph</span> <span class="op">&lt;-</span> <span class="fu">pow2</span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">gmet_mean_summer_sph</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">172</span><span class="op">)</span></span>
<span><span class="va">pseudo_pop_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">cms_mortality_pct</span>,</span>
<span>                                    <span class="va">trimmed_data</span><span class="op">$</span><span class="va">qd_mean_pm25</span>,</span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">[</span>, <span class="va">confounders_s1</span>,</span>
<span>                                                            drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                    ci_appr <span class="op">=</span> <span class="st">"matching"</span>,</span>
<span>                                    pred_model <span class="op">=</span> <span class="st">"sl"</span>,</span>
<span>                                    gps_model <span class="op">=</span> <span class="st">"parametric"</span>,</span>
<span>                                    bin_seq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                    trim_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span> ,</span>
<span>                                                       <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>                                    optimized_compile <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    use_cov_transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    transformers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"pow2"</span>,<span class="st">"pow3"</span>,<span class="st">"clog"</span><span class="op">)</span>,</span>
<span>                                    sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,</span>
<span>                                    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span>,</span>
<span>                                                  xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.28</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>                                    covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                    covar_bl_trs_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                    max_attempt <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    matching_fun <span class="op">=</span> <span class="st">"matching_l1"</span>,</span>
<span>                                    delta_n <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                    scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.150596118336646| Covariate balance threshold: 0.1</span></span>
<span><span class="co">#&gt; Loading required package: nnls</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.046174492691644| Covariate balance threshold: 0.1</span></span>
<span><span class="co">#&gt; Covariate balance condition has been met (iteration: 1/1)</span></span>
<span><span class="co">#&gt; Best mean absolute correlation: 0.046174492691644| Covariate balance threshold: 0.1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pseudo_pop_1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Synthetic-Medicare_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="scenario-2">Scenario 2<a class="anchor" aria-label="anchor" href="#scenario-2"></a>
</h3>
<ul>
<li>Causal Inference: Matching</li>
<li>GPS model: Parametric</li>
<li>Optimized_compile: False</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">172</span><span class="op">)</span></span>
<span><span class="va">pseudo_pop_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">cms_mortality_pct</span>,</span>
<span>                                    <span class="va">trimmed_data</span><span class="op">$</span><span class="va">qd_mean_pm25</span>,</span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">[</span>, <span class="va">confounders_s1</span>,</span>
<span>                                                            drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                    ci_appr <span class="op">=</span> <span class="st">"matching"</span>,</span>
<span>                                    pred_model <span class="op">=</span> <span class="st">"sl"</span>,</span>
<span>                                    gps_model <span class="op">=</span> <span class="st">"parametric"</span>,</span>
<span>                                    bin_seq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                    trim_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span> ,</span>
<span>                                                       <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>                                    optimized_compile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    use_cov_transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    transformers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"pow2"</span>,<span class="st">"pow3"</span>,<span class="st">"clog"</span><span class="op">)</span>,</span>
<span>                                    sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,</span>
<span>                                    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span>,</span>
<span>                                                  xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.28</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>                                    covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                    covar_bl_trs_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                    max_attempt <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    matching_fun <span class="op">=</span> <span class="st">"matching_l1"</span>,</span>
<span>                                    delta_n <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                    scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.150596118336646| Covariate balance threshold: 0.1</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.0468679750728689| Covariate balance threshold: 0.1</span></span>
<span><span class="co">#&gt; Covariate balance condition has been met (iteration: 1/1)</span></span>
<span><span class="co">#&gt; Best mean absolute correlation: 0.0468679750728689| Covariate balance threshold: 0.1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pseudo_pop_2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Synthetic-Medicare_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>By activating <code>optimized_compile</code> flag, we keep track of
number of data samples, instead of aggregating them. Both approach
should result in the same values, however,
<code>optimized_compile</code> version will consume less memory.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimized_data_1</span> <span class="op">&lt;-</span> <span class="va">pseudo_pop_1</span><span class="op">$</span><span class="va">pseudo_pop</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w"</span>,<span class="st">"gps"</span>,<span class="st">"counter_weight"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">nonoptimized_data_2</span> <span class="op">&lt;-</span> <span class="va">pseudo_pop_2</span><span class="op">$</span><span class="va">pseudo_pop</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w"</span>,<span class="st">"gps"</span>,<span class="st">"counter_weight"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Number of rows of data in the optimized approach: "</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">optimized_data_1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of rows of data in the optimized approach:  2300"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Number of rows of data in the non-optimized approach: "</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nonoptimized_data_2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of rows of data in the non-optimized approach:  140300"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Sum of data samples in the optimized approach: "</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">optimized_data_1</span><span class="op">$</span><span class="va">counter_weight</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sum of data samples in the optimized approach:  140300"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Number of data in the non-optimized approach: "</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nonoptimized_data_2</span><span class="op">$</span><span class="va">w</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of data in the non-optimized approach:  140300"</span></span>
<span></span>
<span><span class="co"># Replicate gps values of optimized approach</span></span>
<span><span class="va">expanded_opt_data_1</span> <span class="op">&lt;-</span> <span class="va">optimized_data_1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">optimized_data_1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                            <span class="va">optimized_data_1</span><span class="op">$</span><span class="va">counter_weight</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="va">exp_gps_a_1</span> <span class="op">&lt;-</span> <span class="va">expanded_opt_data_1</span><span class="op">$</span><span class="va">gps</span></span>
<span><span class="va">gps_b_1</span> <span class="op">&lt;-</span> <span class="va">nonoptimized_data_2</span><span class="op">$</span><span class="va">gps</span></span>
<span></span>
<span><span class="va">differences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">gps_b_1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">exp_gps_a_1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Sum of differences in gps values between optimized and "</span>, </span>
<span>            <span class="st">"non-optimized approaches is: "</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">differences</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sum of differences in gps values between optimized and  non-optimized approaches is:  0"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="scenario-3">Scenario 3<a class="anchor" aria-label="anchor" href="#scenario-3"></a>
</h3>
<ul>
<li>Causal Inference: Matching</li>
<li>GPS model: Non-Parametric</li>
<li>Optimized_compile: True</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trimmed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">[</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">)</span> ,<span class="op">]</span>,</span>
<span>                       <span class="va">qd_mean_pm25</span> <span class="op">&lt;=</span> <span class="va">q2</span>  <span class="op">&amp;</span> <span class="va">qd_mean_pm25</span> <span class="op">&gt;=</span> <span class="va">q1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8967</span><span class="op">)</span></span>
<span><span class="va">pseudo_pop_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">cms_mortality_pct</span>,</span>
<span>                                      <span class="va">trimmed_data</span><span class="op">$</span><span class="va">qd_mean_pm25</span>,</span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">[</span>, <span class="va">confounders_s1</span>,</span>
<span>                                                              drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                      ci_appr <span class="op">=</span> <span class="st">"matching"</span>,</span>
<span>                                      pred_model <span class="op">=</span> <span class="st">"sl"</span>,</span>
<span>                                      gps_model <span class="op">=</span> <span class="st">"non-parametric"</span>,</span>
<span>                                      bin_seq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      trim_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span> ,</span>
<span>                                                         <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>                                      optimized_compile <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                      use_cov_transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                      transformers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"pow2"</span>,<span class="st">"pow3"</span>,<span class="st">"clog"</span><span class="op">)</span>,</span>
<span>                                      sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,</span>
<span>                                      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>                                                    xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                      nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                      covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>                                      covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                      covar_bl_trs_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                      max_attempt <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                      matching_fun <span class="op">=</span> <span class="st">"matching_l1"</span>,</span>
<span>                                      delta_n <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                      scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.150596118336646| Covariate balance threshold: 0.1</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.0524109107056938| Covariate balance threshold: 0.1</span></span>
<span><span class="co">#&gt; Covariate balance condition has been met (iteration: 1/1)</span></span>
<span><span class="co">#&gt; Best mean absolute correlation: 0.0524109107056938| Covariate balance threshold: 0.1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pseudo_pop_3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Synthetic-Medicare_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="scenario-4">Scenario 4<a class="anchor" aria-label="anchor" href="#scenario-4"></a>
</h3>
<ul>
<li>Causal Inference: Weighting</li>
<li>GPS model: Parametric</li>
<li>Optimized_compile: N/A</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trimmed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">[</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">)</span> ,<span class="op">]</span>,</span>
<span>                       <span class="va">qd_mean_pm25</span> <span class="op">&lt;=</span> <span class="va">q2</span>  <span class="op">&amp;</span> <span class="va">qd_mean_pm25</span> <span class="op">&gt;=</span> <span class="va">q1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">cs_poverty</span> <span class="op">&lt;-</span> <span class="fu">pow2</span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">cs_poverty</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">672</span><span class="op">)</span></span>
<span><span class="va">pseudo_pop_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">cms_mortality_pct</span>,</span>
<span>                                      <span class="va">trimmed_data</span><span class="op">$</span><span class="va">qd_mean_pm25</span>,</span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">[</span>, <span class="va">confounders_s1</span>,</span>
<span>                                                              drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                      ci_appr <span class="op">=</span> <span class="st">"weighting"</span>,</span>
<span>                                      pred_model <span class="op">=</span> <span class="st">"sl"</span>,</span>
<span>                                      gps_model <span class="op">=</span> <span class="st">"parametric"</span>,</span>
<span>                                      bin_seq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      trim_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span> ,</span>
<span>                                                         <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>                                      optimized_compile <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                      use_cov_transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                      transformers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"pow2"</span>,<span class="st">"pow3"</span>,<span class="st">"clog"</span><span class="op">)</span>,</span>
<span>                                      sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,</span>
<span>                                      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span><span class="op">)</span>,</span>
<span>                                                    xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.14</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                      nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                      covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>                                      covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                      covar_bl_trs_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                      max_attempt <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                      matching_fun <span class="op">=</span> <span class="st">"matching_l1"</span>,</span>
<span>                                      delta_n <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                      scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.150596118336646| Covariate balance threshold: 0.1</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.0552116564078729| Covariate balance threshold: 0.1</span></span>
<span><span class="co">#&gt; Covariate balance condition has been met (iteration: 1/1)</span></span>
<span><span class="co">#&gt; Best mean absolute correlation: 0.0552116564078729| Covariate balance threshold: 0.1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pseudo_pop_4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Synthetic-Medicare_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="covariate-balance">Covariate Balance<a class="anchor" aria-label="anchor" href="#covariate-balance"></a>
</h2>
<p>In the previous examples, we passed specific parameters for
estimating GPS values. Achieving acceptable covariate balance can be
computed by searching for the most appropriate parameters and might not
be a simple task. This package uses transformers on the features to get
an acceptable covariate balance. The following parameters are directly
related to searching for an acceptable covariate balance.</p>
<ul>
<li>
<strong>covar_bl_trs</strong>: Is the acceptable threshold to stop
searching. It can be computed either by <code>mean</code>,
<code>median</code>, or <code>maximal</code> value of features
correlation, which is defined in
<strong>covar_bl_trs_type</strong>.</li>
<li>
<strong>params</strong>: In different iterations, we choose a
parameter at random from the provided list. For example, by
<code>xgb_nrounds=seq(1,100)</code> in the parameters,
<code>nround</code> parameter for <code>xgboost</code> trainer will be
selected a number between 1 and 100 at random, at each iteration.</li>
<li>
<strong>transformers</strong>: After each iteration, we choose a
feature with the highest correlation and apply a transformer from the
provided list. All transformers should be applied to a feature before
reapplying the same transformer on the same feature.</li>
<li>
<strong>max_attempt</strong>: Number of test iteration. If the
covar_bl_trs is not met, the search will stop after max_attempt
iteration and will return the best found population.</li>
</ul>
<div class="section level3">
<h3 id="scenario-5">Scenario 5<a class="anchor" aria-label="anchor" href="#scenario-5"></a>
</h3>
<ul>
<li><p>Causal Inference: Matching + searching for acceptable covariate
balance</p></li>
<li><p>GPS model: Non-Parametric</p></li>
<li><p>Optimized_compile: True</p></li>
<li>
<p>Search domain:</p>
<ul>
<li>
<code>transformers</code>: <code>pow2</code>, <code>pow3</code>,
<code>clog</code>.</li>
<li>
<code>nround</code> for <code>xgboost</code>: 10-100.</li>
<li>
<code>eta</code> for <code>xgboost</code>: 0.1-0.5.</li>
<li>
<code>max_attempt</code>: 5.</li>
<li>
<code>covar_bl_trs</code>: 0.08.</li>
<li>
<code>covar_bl_trs_type</code>: <code>mean</code>
</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trimmed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">[</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">study_data</span><span class="op">)</span> ,<span class="op">]</span>,</span>
<span>                       <span class="va">qd_mean_pm25</span> <span class="op">&lt;=</span> <span class="va">q2</span>  <span class="op">&amp;</span> <span class="va">qd_mean_pm25</span> <span class="op">&gt;=</span> <span class="va">q1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">328</span><span class="op">)</span></span>
<span><span class="va">pseudo_pop_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">$</span><span class="va">cms_mortality_pct</span>,</span>
<span>                                      <span class="va">trimmed_data</span><span class="op">$</span><span class="va">qd_mean_pm25</span>,</span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">trimmed_data</span><span class="op">[</span>, <span class="va">confounders_s1</span>,</span>
<span>                                                              drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                      ci_appr <span class="op">=</span> <span class="st">"matching"</span>,</span>
<span>                                      pred_model <span class="op">=</span> <span class="st">"sl"</span>,</span>
<span>                                      gps_model <span class="op">=</span> <span class="st">"non-parametric"</span>,</span>
<span>                                      bin_seq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      trim_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span> ,</span>
<span>                                                         <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>                                      optimized_compile <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                      use_cov_transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                      transformers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"pow2"</span>,<span class="st">"pow3"</span>,<span class="st">"clog"</span><span class="op">)</span>,</span>
<span>                                      sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,</span>
<span>                                      params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                                    xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                      nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                      covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>                                      covar_bl_trs <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>                                      covar_bl_trs_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                      max_attempt <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                      matching_fun <span class="op">=</span> <span class="st">"matching_l1"</span>,</span>
<span>                                      delta_n <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                      scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.150596118336646| Covariate balance threshold: 0.08</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.123384745637948| Covariate balance threshold: 0.08</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.200329942130683| Covariate balance threshold: 0.08</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.165235822265409| Covariate balance threshold: 0.08</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.160530585591875| Covariate balance threshold: 0.08</span></span>
<span><span class="co">#&gt; mean absolute correlation: 0.180224262686973| Covariate balance threshold: 0.08</span></span>
<span><span class="co">#&gt; Covariate balance condition has not been met.</span></span>
<span><span class="co">#&gt; Best mean absolute correlation: 0.123384745637948| Covariate balance threshold: 0.08</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pseudo_pop_5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Synthetic-Medicare_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>In this example, after 5 attempts, we could not find a pseudo
population that can satisfy the covariate balance test.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-khoshnevis_2022" class="csl-entry">
Khoshnevis, Naeem, Xiao Wu, and Danielle Braun. 2022. <span>“<span class="nocase">Synthetic Medicare Data for Environmental Health
Studies</span>.”</span> Harvard Dataverse. <a href="https://doi.org/10.7910/DVN/L7YF2G" class="external-link">https://doi.org/10.7910/DVN/L7YF2G</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Naeem Khoshnevis, Xiao Wu, Danielle Braun.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
