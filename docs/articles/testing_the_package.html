<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Testing the Package • CausalGPS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Testing the Package">
<meta property="og:description" content="CausalGPS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CausalGPS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/CausalGPS.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Introduction</li>
    <li>
      <a href="../articles/estimating_gps.html">Estimating GPS</a>
    </li>
    <li>
      <a href="../articles/generating_pseudo_population.html">Generating Pseudo Population</a>
    </li>
    <li>
      <a href="../articles/outcome_models.html">Outcome Models</a>
    </li>
    <li>
      <a href="../articles/generate_synthetic_data.html">Generate Synthetic Data</a>
    </li>
    <li>
      <a href="../articles/faq.html">Frequently Asked Questions</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Collabration</li>
    <li>
      <a href="../articles/contribution.html">Developers Guide</a>
    </li>
    <li>
      <a href="../articles/testing_the_package.html">Testing the Package</a>
    </li>
    <li>
      <a href="../articles/notes_on_sl_wrapper.html">Notes on SL Wrappers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fasrc/CausalGPS/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="testing_the_package_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Testing the Package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fasrc/CausalGPS/blob/master/vignettes/testing_the_package.Rmd"><code>vignettes/testing_the_package.Rmd</code></a></small>
      <div class="hidden name"><code>testing_the_package.Rmd</code></div>

    </div>

    
    
<p>Testing the package is an important part of package development. Although we are unit-testing the functions, there is always a situation that is not tested. Please feel free to try the code under different conditions. Please report the bugs as a <a href="https://github.com/fasrc/CausalGPS/issues">new issue</a>. In the following, there steps to generate synthetic data and conduct some testing.</p>
<p>In order to test the package, you need to have the code on your system (R (&gt;= 3.5.0)). There are two options:</p>
<ul>
<li>Installing the package</li>
<li>Cloning the package</li>
<li>Forking the package</li>
</ul>
<p>If you are running the code on a cluster and trying to carry out some test on scaling out, installing it is the best option. However, if you want to dig deeper and debug the code interactively, cloning the code is your choice. If you are planning to test, debug, and commit the changes, use forking. In the following, we explain all these options.</p>
<div id="getting-the-code" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-the-code" class="anchor"></a>Getting the Code</h2>
<div id="installing-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#installing-the-package" class="anchor"></a>Installing the Package</h3>
<p>Use <code><a href="https://devtools.r-lib.org//reference/remote-reexports.html">devtools::install_github</a></code> to install the package. If you do not specify the <code>ref</code>, it will install the master (or main) branch. The <code>master</code> branch hosts the latest released code. The latest updates are committed to the <code>develop</code> branch. Read <a href="contribution.Rmd">Git Branching Model</a> for more details.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/detach.html">detach</a></span><span class="op">(</span><span class="st">"package:CausalGPS"</span>, unload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># if already you have the package, detach and unload it, to have a new install. </span>
<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"fasrc/CausalGPS"</span>, ref<span class="op">=</span><span class="st">"develop"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fasrc/CausalGPS">CausalGPS</a></span><span class="op">)</span></code></pre></div>
<p>The process should run smoothly. Try <code><a href="../reference/CausalGPS-package.html">?CausalGPS</a></code>. It should open the package description page under the help tab (assuming you are using RStudio).</p>
</div>
<div id="cloning-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#cloning-the-package" class="anchor"></a>Cloning the Package</h3>
<p>Go to the package <a href="https://github.com/fasrc/CausalGPS">Github repository</a>, at the top left (A), choose the branch that you want to clone, then click on the <code>Code</code> button (B), then choose <code>Download ZIP</code>. The following figure shows the buttons’ location.</p>
<p float="center">
<img src="../man/figures/png/testing_example_discussion_fig1.png" width="600"></p>
<p>After cloning the code, open one of the files using RStudio, then change the project directory to the project directory (<code>Session &gt; Set Working Directory &gt; To Project Directory</code>).</p>
</div>
<div id="forking-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#forking-the-package" class="anchor"></a>Forking the package</h3>
<p>Forking is explained in the <a href="contribution.html">Contribution</a> page.</p>
</div>
</div>
<div id="package-development-test-check-cycle" class="section level2">
<h2 class="hasAnchor">
<a href="#package-development-test-check-cycle" class="anchor"></a>Package development, test, check cycle</h2>
<p>There are some commands that you need to use during testing and debugging the package. You can read about these commands in <a href="https://r-pkgs.org/">R Packages</a> book. For debugging and testing, you do not need to know all steps. Here is the list of commands that you need:</p>
<ul>
<li>
<code><a href="https://devtools.r-lib.org//reference/document.html">document()</a></code> if you change Roxygen Skeleton (e.g., you added new argument to the function, or improved the example), run <code>documents()</code>. It will make sure that your internal documentation is updated.</li>
<li>
<code><a href="https://devtools.r-lib.org//reference/test.html">test()</a></code> runs all tests that is located inside the <code>tests/testthat</code> folder. Any modification to the code should be followed by running <code><a href="https://devtools.r-lib.org//reference/test.html">test()</a></code> to make sure that you are not breaking existing functionality.</li>
<li>
<code><a href="https://devtools.r-lib.org//reference/check.html">check()</a></code> checks many other features (e.g., whether the package can be installed without problem). You do not need to run <code><a href="https://devtools.r-lib.org//reference/check.html">check()</a></code> frequently; however, we would suggest running it once you get the code and once before committing to make sure that there are no errors, warnings, and notes.</li>
<li>
<code><a href="https://devtools.r-lib.org//reference/load_all.html">load_all()</a></code> the program source code is different than the one which is loaded on your memory (read more <a href="https://r-pkgs.org/package-structure-state.html">here</a>). If you modify some part of the code, you need to load it on memory to takes the latest modifications effect. Run <code><a href="https://devtools.r-lib.org//reference/load_all.html">load_all()</a></code> after modification and before testing.</li>
<li>
<code><a href="https://devtools.r-lib.org//reference/install.html">install()</a></code> in most of the cases <code><a href="https://devtools.r-lib.org//reference/load_all.html">load_all()</a></code> is sufficient. However, sometimes the links between package components are broken. It especially happens when you significantly change some part of the code, and it does not pass the tests. In such cases, you may need to run <code><a href="https://devtools.r-lib.org//reference/install.html">install()</a></code>.</li>
</ul>
</div>
<div id="running-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#running-examples" class="anchor"></a>Running Examples</h2>
<p>You can use any causal inference studies data to test the package. The database needs to have the following attributes:</p>
<ul>
<li>
<strong><code>Y</code></strong>: Output value</li>
<li>
<strong><code>w</code></strong>: Treatment</li>
<li>
<strong><code>C</code></strong>: covariate matrix</li>
</ul>
<p>The package can generate synthetic data that can be used to test different features of the package. At the current implementation, the code only generates synthetic numerical data; however, with small innovation, one can add categorical data. In the following, we present some reproducible examples that you can copy and build upon them.</p>
<div id="generating-synthetic-data" class="section level3">
<h3 class="hasAnchor">
<a href="#generating-synthetic-data" class="anchor"></a>Generating Synthetic Data</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/fasrc/CausalGPS">"CausalGPS"</a></span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span>
<span class="co">#'data.frame':  10000 obs. of  8 variables:</span>
<span class="co"># $ Y    : num  -17 3.66 -45.88 -12.12 2.75 ...</span>
<span class="co"># $ treat: num  9.74 14.88 5.22 10.19 16.65 ...</span>
<span class="co"># $ cf1  : num  -0.128 0.155 -1.271 0.551 0.846 ...</span>
<span class="co"># $ cf2  : num  0.2376 0.0466 0.8918 -1.8434 -2.4487 ...</span>
<span class="co"># $ cf3  : num  1.5492 -0.4453 0.0718 0.8309 0.6749 ...</span>
<span class="co"># $ cf4  : num  1.3738 0.8621 0.4735 0.7013 -0.0851 ...</span>
<span class="co"># $ cf5  : num  -2 2 1 -2 0 1 1 2 -2 -1 ...</span>
<span class="co"># $ cf6  : num  -1.794 -1.822 0.79 -0.591 2.673 ...</span></code></pre></div>
</div>
<div id="estimating-gps-values-for-the-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-gps-values-for-the-dataset" class="anchor"></a>Estimating GPS Values for the Dataset</h3>
<p>In the following example, first, we generate 10000 synthetic data samples, then we feed them into <code>estimate_gps</code> function to estimate their GPS values. Please note that the Y variable is not used inside the code, and it is only provided to cbind with the generated GPS values. You can read more about different arguments in the documentation (<code><a href="../reference/estimate_gps.html">?estimate_gps</a></code>). In summary, - We want to run a code using SuperLearner (<code>sl</code>) prediction model. Inside the SuperLearner package, we want to use the XGBoost package. As you know, we internally generate a customized wrapper for the XGBoost package; thus, the correct way to activate that is by passing <code>m_xgboost</code>, which stands for <em>modified xgboost</em>. - We requested for one thread (<code>nthread = 1</code>); you can use as much as you want; the package will use the available one and will ignore the rest of them. XGBoost uses OpenMP backend to use all cores. Sometimes it becomes a really big challenge on Mac systems. So if you are using Mac and do not see any performance improvement, be aware of that. - In <code>params</code>, we passed the list of parameters; the function will choose one from each list at random and will generate a customize wrapper based on them. If you want to use a specific value, just give a list one number (e.g., xgb_max_depth = c(3)). All parameters that start with <code>xgb_</code> will only change XGBoost hyperparameters.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/fasrc/CausalGPS">"CausalGPS"</a></span><span class="op">)</span>
<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> 
<span class="va">data_with_gps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_gps.html">estimate_gps</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">Y</span>,
                              <span class="va">mydata</span><span class="op">$</span><span class="va">treat</span>,
                              <span class="va">mydata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cf1"</span>,<span class="st">"cf2"</span>,<span class="st">"cf3"</span>,<span class="st">"cf4"</span>,<span class="st">"cf5"</span>,<span class="st">"cf6"</span><span class="op">)</span><span class="op">]</span>,
                              pred_model <span class="op">=</span> <span class="st">"sl"</span>,
                              internal_use <span class="op">=</span> <span class="cn">FALSE</span>,
                              params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>xgb_max_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>,
                                       xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span><span class="op">)</span><span class="op">)</span>,
                              nthread <span class="op">=</span> <span class="fl">1</span>,
                              sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>
                             <span class="op">)</span></code></pre></div>
<p>Now, let’s add some categorical data. Let’s say our data belongs to 5 different years (2000 observations per year), and each year we have data from 4 different regions, including <em>North</em>, <em>South</em>, <em>East</em>, and <em>West</em>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/fasrc/CausalGPS">"CausalGPS"</a></span><span class="op">)</span>
<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> 

<span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2001"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2002"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2003"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2004"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>, 
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2005"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>

<span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"North"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"South"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"East"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"West"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>

<span class="va">mydata</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>
<span class="va">mydata</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>

<span class="va">data_with_gps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_gps.html">estimate_gps</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">Y</span>,
                              <span class="va">mydata</span><span class="op">$</span><span class="va">treat</span>,
                              <span class="va">mydata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cf1"</span>,<span class="st">"cf2"</span>,<span class="st">"cf3"</span>,<span class="st">"cf4"</span>,<span class="st">"cf5"</span>,<span class="st">"cf6"</span>, <span class="st">"year"</span>, <span class="st">"region"</span><span class="op">)</span><span class="op">]</span>,
                              pred_model <span class="op">=</span> <span class="st">"sl"</span>,
                              internal_use <span class="op">=</span> <span class="cn">FALSE</span>,
                              params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>xgb_max_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>,
                                       xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span><span class="op">)</span><span class="op">)</span>,
                              nthread <span class="op">=</span> <span class="fl">1</span>,
                              sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>
                             <span class="op">)</span></code></pre></div>
</div>
<div id="generating-pseudo-population" class="section level3">
<h3 class="hasAnchor">
<a href="#generating-pseudo-population" class="anchor"></a>Generating Pseudo Population</h3>
<p>Generating pseudo population (<code>gen_pseudo_pop()</code>)is one of the important parts of the package. It internally uses <code><a href="../reference/estimate_gps.html">estimate_gps()</a></code> package. An acceptable pseudo population should pass the covariate balance test. Users choose which test and what threshold, and how many attempts. If the covariate balance test is met, the function stops trying and returns the generated population. However, if it cannot pass the test, it still returns what is generated with a message to the user indicating the population did not pass the test. At each iteration, we change the hyperparameters to modify GPS values (to better or worse) to pass the covariate balance test. After estimating the GPS values, we need to compile the population. There are three major approaches to compile pseudo population, including:</p>
<ul>
<li>Matching</li>
<li>Adjusting (not implemented)</li>
<li>Weighting (not implemented)</li>
</ul>
<p>Among different methods for testing covariate balance test, only <code>absolute</code> approach is implemented.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/fasrc/CausalGPS">"CausalGPS"</a></span><span class="op">)</span>
<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> 
<span class="va">pseudo_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">Y</span>,
                                  <span class="va">mydata</span><span class="op">$</span><span class="va">treat</span>,
                                  <span class="va">mydata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cf1"</span>,<span class="st">"cf2"</span>,<span class="st">"cf3"</span>,<span class="st">"cf4"</span>,<span class="st">"cf5"</span>,<span class="st">"cf6"</span><span class="op">)</span><span class="op">]</span>,
                                  ci_appr <span class="op">=</span> <span class="st">"matching"</span>,
                                  pred_model <span class="op">=</span> <span class="st">"sl"</span>,
                                  sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,
                                  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span><span class="op">)</span>,
                                  xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,
                                  nthread <span class="op">=</span> <span class="fl">1</span>,
                                  covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,
                                  covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,
                                  max_attempt <span class="op">=</span> <span class="fl">1</span>,
                                  matching_fun <span class="op">=</span> <span class="st">"matching_l1"</span>,
                                  delta_n <span class="op">=</span> <span class="fl">1</span>,
                                  scale <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p>The second causal inference approach is <code>weighting</code>. Here is an example to generate pseudo population using <code>weighting</code> approach.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> 

<span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2001"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2002"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2003"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2004"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>, 
          <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2005"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span>

<span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"North"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"South"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"East"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"West"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>

<span class="va">mydata</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>
<span class="va">mydata</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>

<span class="va">pseudo_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">Y</span>,
                                  <span class="va">mydata</span><span class="op">$</span><span class="va">treat</span>,
                                  <span class="va">mydata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cf1"</span>,<span class="st">"cf2"</span>,<span class="st">"cf3"</span>,<span class="st">"cf4"</span>,<span class="st">"cf5"</span>,<span class="st">"cf6"</span>,<span class="st">"year"</span>,<span class="st">"region"</span><span class="op">)</span><span class="op">]</span>,
                                  ci_appr <span class="op">=</span> <span class="st">"weighting"</span>,
                                  pred_model <span class="op">=</span> <span class="st">"sl"</span>,
                                  sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,
                                  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span><span class="op">)</span>,
                                   xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,
                                  nthread <span class="op">=</span> <span class="fl">1</span>,
                                  covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,
                                  covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,
                                  max_attempt <span class="op">=</span> <span class="fl">1</span>
                                  <span class="op">)</span></code></pre></div>
</div>
<div id="further-processing" class="section level3">
<h3 class="hasAnchor">
<a href="#further-processing" class="anchor"></a>Further Processing</h3>
<p>After generating a pseudo population, we can process the data for different purposes. So far, estimating exposure rate function (<code>estimate_erf</code>) is implemented.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># library("CausalGPS")</span>
<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> 
<span class="va">pseudo_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">Y</span>,
                                  <span class="va">mydata</span><span class="op">$</span><span class="va">treat</span>,
                                  <span class="va">mydata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cf1"</span>,<span class="st">"cf2"</span>,<span class="st">"cf3"</span>,<span class="st">"cf4"</span>,<span class="st">"cf5"</span>,<span class="st">"cf6"</span><span class="op">)</span><span class="op">]</span>,
                                  ci_appr <span class="op">=</span> <span class="st">"matching"</span>,
                                  pred_model <span class="op">=</span> <span class="st">"sl"</span>,
                                  sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,
                                  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span><span class="op">)</span>,
                                   xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,
                                  nthread <span class="op">=</span> <span class="fl">1</span>,
                                  covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,
                                  covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,
                                  max_attempt <span class="op">=</span> <span class="fl">1</span>,
                                  matching_fun <span class="op">=</span> <span class="st">"matching_l1"</span>,
                                  delta_n <span class="op">=</span> <span class="fl">1</span>,
                                  scale <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>

<span class="va">erf_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_npmetric_erf.html">estimate_npmetric_erf</a></span><span class="op">(</span><span class="va">pseudo_pop</span><span class="op">$</span><span class="va">pseudo_pop</span><span class="op">$</span><span class="va">Y</span>,
                                 <span class="va">pseudo_pop</span><span class="op">$</span><span class="va">pseudo_pop</span><span class="op">$</span><span class="va">w</span>,
                                 bw_seq<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">2</span>,<span class="fl">0.2</span><span class="op">)</span>,
                                 w_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">20</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="steps-for-using-precomputed-data-during-the-test" class="section level2">
<h2 class="hasAnchor">
<a href="#steps-for-using-precomputed-data-during-the-test" class="anchor"></a>Steps for using precomputed data during the test</h2>
<p>The package is being tested on different data samples, some of them are generated during testing, and some others are generated before and just are loaded. These data are located in “R/sysdata.rda” file. If you add new features to the code, you may need to use some external or pre-computed data set to test your functions. In the following, we explain the steps to append data to “R/sysdata.rda”. Please note that CRAN might reject large data sets.</p>
<ul>
<li><p>Step 1: Run <code><a href="https://devtools.r-lib.org//reference/check.html">check()</a></code> to make sure that the file as-is satisfies all test requirements. If it raises an error, warning, or note, please address them before modifying the data. In some rare cases, <code><a href="https://devtools.r-lib.org//reference/check.html">check()</a></code> does not pass successfully, however, test() does. This is sufficient for changing the data; however, you need to address it before submitting a pull request.</p></li>
<li><p>Step 2: Create a backup data from the current data.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode s"><code class="sourceCode gnuassembler"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in terminal</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>cp  R/sysdata.rda R/sysdata_backup.rda</span></code></pre></div>
<ul>
<li>Step 3: Clean Global environment</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li>Step 4: Load current data and store the names</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"R/sysdata.rd"</span><span class="op">)</span>
<span class="va">list_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<ul>
<li>Step 5: Generate your data (mydata) and make sure to add steps to reproduce that data as a comment in your test file.</li>
<li>Step 6: Add new data name to <code>list_names</code>. Please note the quotes. You do not need to add data, just the name.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">list_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">list_names</span>, <span class="st">"mydata"</span><span class="op">)</span> </code></pre></div>
<ul>
<li>Step 7: Save the data.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span>list<span class="op">=</span><span class="va">list_names</span>, file<span class="op">=</span><span class="st">"R/sysdata.rda"</span><span class="op">)</span></code></pre></div>
<ul>
<li>Step 8: Run <code>check()/test()</code> to make sure that it passes all tests. If it does not pass all tests, address the problem.</li>
<li>Step 9: After successful <code>check()/pass()</code> remove the backup file.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Naeem Khoshnevis, Xiao Wu, Danielle Braun.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
